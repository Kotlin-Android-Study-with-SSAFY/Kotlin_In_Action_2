# ëŒë‹¤ ì‹ê³¼ ë©¤ë²„ ì°¸ì¡°

> Kotlin in action (p.198 ~ p.213)

## ëŒë‹¤ ì‹

ëŒë‹¤ = ëŒë‹¤ì‹ì´ë€?

- ë‹¤ë¥¸ í•¨ìˆ˜ì— ë„˜ê¸¸ ìˆ˜ ìˆëŠ” ì‘ì€ ì½”ë“œ ì¡°ê°
- ëŒë‹¤ëŠ” í•¨ìˆ˜ì˜ í•œ í˜•íƒœ
- ë³€ìˆ˜ì— ì €ì¥ ê°€ëŠ¥

<br>

ì˜ˆì „ ìë°”ì—ì„œëŠ” ì¼ë ¨ì˜ ë™ì‘ì„ ë³€ìˆ˜ì— ì €ì¥í•˜ê±°ë‚˜ í•¨ìˆ˜ì— ë„˜ê¸°ê¸° ìœ„í•´ ìµëª… í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í–ˆë‹¤.

**í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°ì—ì„œëŠ” í•¨ìˆ˜ë¥¼ ê°’ì²˜ëŸ¼ ë‹¤ë£¨ë¯€ë¡œ ìœ„ ë¬¸ì œ ì‰½ê²Œ í•´ê²° ê°€ëŠ¥í•˜ë‹¤.**

â†’ í•¨ìˆ˜ ì§ì ‘ ë‹¤ë¥¸ í•¨ìˆ˜ì— ì „ë‹¬ ê°€ëŠ¥, ëŒë‹¤ ì‹ìœ¼ë¡œ ê°„ê²°í•œ ì½”ë“œ ì‘ì„± ê°€ëŠ¥

- ìë°”ì—ì„œ ë™ì‘ì„ í•¨ìˆ˜ì— ë„˜ê¸°ê¸° ìœ„í•´ ìµëª… í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•œ ì˜ˆì‹œ ì½”ë“œ

```java
button.setOnClickListener(new OnClickListener() {
	@Override
	public void onClick(View view) {
		// ë²„íŠ¼ í´ë¦­ ì‹œ ë™ì‘ ì‘ì„±
	}
});
```

ì½”í‹€ë¦°ì—ì„œëŠ” ìë°”8ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ëŒë‹¤ ì‘ì„± ê°€ëŠ¥í•˜ë‹¤.

- ëŒë‹¤ ì‚¬ìš©

```kotlin
button.setOnClickListener{ /*ë²„íŠ¼ í´ë¦­ ì‹œ ë™ì‘ ì‘ì„±*/ }
```

<br>

## ëŒë‹¤ì™€ ì»¬ë ‰ì…˜

ì»¬ë ‰ì…˜ì„ ë‹¤ë£° ë•Œ ìˆ˜í–‰í•˜ëŠ” ì‘ì—…ë“¤ì€ ë³´í†µ ì •í•´ì ¸ìˆìŒ (maxê°’ ì°¾ê¸° ë“±)

ì´ëŸ° ì‘ì—…ë“¤ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ì œê³µë˜ë©´ í¸ë¦¬í•˜ë‹¤.

í•˜ì§€ë§Œ, ëŒë‹¤ê°€ ì—†ì„ ê²½ìš° í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•˜ê¸° ì¢‹ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì œê³µì´ í˜ë“¤ë‹¤.

ìë°”ì—ì„œëŠ” í•„ìš”í•œ ì»¬ë ‰ì…˜ ê¸°ëŠ¥ì„ ì§ì ‘ ì‘ì„±í–ˆì§€ë§Œ, ì½”í‹€ë¦°ì—ì„œëŠ” ì œê³µí•´ì¤Œ

ex) ìë°”ì—ì„œ maxê°’ ì°¾ì„ ë•Œ

```kotlin
data class Person(val name: String, val age: Int)

fun findTheOldest(people: List<Person>) {
    var maxAge = 0 // ê°€ì¥ ë§ì€ ë‚˜ì´ë¥¼ ì €ì¥
    var theOldest: Person? = null // ê°€ì¥ ì—°ì¥ìë¥¼ ì €ì¥
    for (person in people) {
        if (person.age > maxAge) {  // ì—°ì¥ìë¥¼ ë¹„êµ
            maxAge = person.age
            theOldest = person
        }
    }
    println(theOldest)
}

fun main(args: Array<String>) {
    val people = listOf(Person("Alice", 29), Person("Bob", 31))
    findTheOldest(people)
}
```

ì½”í‹€ë¦°ì—ì„œëŠ” ì´ë¯¸ ê°™ì€ ê¸°ëŠ¥ì„ í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì œê³µí•˜ë¯€ë¡œ

```kotlin
people.maxBy {it.age}
```

ëì´ë‹¤.

## ëŒë‹¤ì‹ ë¬¸ë²•

```kotlin
{ x: Int, y: Int -> x + y }
// { ì¸ì ëª©ë¡ -> ë³¸ë¬¸ }
```

ì½”í‹€ë¦° ëŒë‹¤ ì‹ì€ í•­ìƒ **ì¤‘ê´„í˜¸**ë¡œ ë‘˜ëŸ¬ì‹¸ì—¬ ìˆë‹¤.

**í™”ì‚´í‘œ**( â†’ )ê°€ **ì¸ì ëª©ë¡**ê³¼ **ëŒë‹¤ ë³¸ë¬¸**ì„ **êµ¬ë¶„**í•œë‹¤.

```kotlin
val sum = { x: Int, y: Int -> x + y }
```

ë‹¹ì—°íˆ, ë³€ìˆ˜ì— ì €ì¥ ê°€ëŠ¥í•˜ë‹¤.

ì•„ë˜ëŠ” `maxBy` í•¨ìˆ˜ë¥¼ ë‹¤ì–‘í•œ í˜•íƒœë¡œ ì‚¬ìš©í•œ ì˜ˆì‹œ ì½”ë“œì´ë‹¤.

```kotlin
people.maxBy({ p: Person -> p.age }) // ëŒë‹¤ì˜ ê¸°ë³¸ í˜•íƒœ

people.maxBy() { p: Person -> p.age } // ëŒë‹¤ê°€ ë§ˆì§€ë§‰ ì¸ìì´ë¯€ë¡œ ê´„í˜¸ ë’¤ì— ë°°ì¹˜ ê°€ëŠ¥

people.maxBy { p: Person -> p.age } // ëŒë‹¤ê°€ ìœ ì¼í•œ ì¸ìì´ë¯€ë¡œ ë¹ˆ ê´„í˜¸ ì œê±° ê°€ëŠ¥

people.maxBy { p -> p.age } // íŒŒë¼ë¯¸í„° íƒ€ì… ìƒëµ ê°€ëŠ¥ (íƒ€ì… ì¶”ë¡ , ì»¬ë ‰ì…˜ ì›ì†Œì˜ íƒ€ì…)

people.maxBy { it.age } // íŒŒë¼ë¯¸í„°ê°€ í•˜ë‚˜ì¼ ê²½ìš°, íƒ€ì… ì¶”ë¡ ì´ ê°€ëŠ¥í•œ ê²½ìš° ìƒëµ ê°€ëŠ¥
```

```kotlin
public inline fun <T, R : Comparable<R>> Iterable<T>.maxBy(selector: (T) -> R): T? {
    return maxByOrNull(selector)
}

public inline fun <T, R : Comparable<R>> Iterable<T>.maxByOrNull(selector: (T) -> R): T? {
    val iterator = iterator()
    if (!iterator.hasNext()) return null
    var maxElem = iterator.next()
    if (!iterator.hasNext()) return maxElem
    var maxValue = selector(maxElem)
    do {
        val e = iterator.next()
        val v = selector(e)
        if (maxValue < v) {
            maxElem = e
            maxValue = v
        }
    } while (iterator.hasNext())
    return maxElem
}
```

<aside>
ğŸ’¡

**[ì£¼ì˜!]** it ì„ ì‚¬ìš©í•˜ë©´ ì½”ë“œê°€ ì•„ì£¼ ê°„ë‹¨í•˜ê²Œ ë§Œë“¤ì–´ì£¼ì§€ë§Œ, ëŒë‹¤ê°€ ì¤‘ì²©ë˜ê±°ë‚˜ íŒŒë¼ë¯¸í„°ì˜ ì˜ë¯¸ë¥¼ ì‰½ê²Œ ì•Œ ìˆ˜ ì—†ëŠ” ê²½ìš° ëª…ì‹œì ìœ¼ë¡œ ì„ ì–¸í•˜ì!

</aside>

`joinToString` ì˜ˆì œ

```kotlin
val people = listOf(Person("Alice", 29), Person("Bob", 31))
---
val names = people.joinToString(separator = " ", transform = { p: Person -> p.name })
val names = people.joinToString(separator = " ") {p: Person -> p.name
```

**ë³¸ë¬¸ì´ ì—¬ëŸ¬ì¤„ë¡œ ì´ë¤„ì§„ ëŒë‹¤ì˜ ê²½ìš°, ë§¨ ë§ˆì§€ë§‰ì— ìˆëŠ” ì‹ì´ ëŒë‹¤ì˜ ê²°ê³¼ ê°’ì´ ëœë‹¤!**

```kotlin
val sum = {x:Int, y:Int ->
	println("ë”í•˜ê¸°ì…ë‹ˆë‹¤")
	x+y // ëŒë‹¤ì˜ ê²°ê³¼
}
```

- Quiz
  ```kotlin
  val sum = {x:Int, y:Int ->
  	x+y
  	println("ë”í•˜ê¸°ì…ë‹ˆë‹¤")
  }
  ```
  ìœ„ ì½”ë“œì—ì„œ ëŒë‹¤ì˜ ê²°ê³¼ ê°’ì€?

<br>

## í˜„ì¬ ì˜ì—­ì— ìˆëŠ” ë³€ìˆ˜ì— ì ‘ê·¼

ìë°” ë©”ì„œë“œ ì•ˆì—ì„œ ìµëª… í´ë˜ìŠ¤ë¥¼ ì •ì˜í•  ë•Œ ë©”ì„œë“œì˜ ë¡œì»¬ ë³€ìˆ˜ë¥¼ ìµëª… í´ë˜ìŠ¤ ì•ˆì—ì„œ ì‚¬ìš© ê°€ëŠ¥

ì¶”ê°€ë¡œ, ì½”í‹€ë¦° ëŒë‹¤ëŠ” **ëŒë‹¤ ë°– í•¨ìˆ˜ì— ìˆëŠ” finalì´ ì•„ë‹Œ ë³€ìˆ˜ì— ì ‘ê·¼ ë° ë³€ê²½ ê°€ëŠ¥**í•˜ë‹¤.

- ëŒë‹¤ ë°– ë³€ìˆ˜ ì ‘ê·¼

```kotlin
fun printMessagesWithPrefix(messages: Collection<String>, prefix: String) {
    messages.forEach {
        println("$prefix $it")  // ëŒë‹¤ ì•ˆì—ì„œ í•¨ìˆ˜ì˜ prefix íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©
    }
}

fun main(args: Array<String>) {
    val errors = listOf("403 Forbidden", "404 Not Found")
    printMessagesWithPrefix(errors, "Error:")
}
```

- ëŒë‹¤ ë°– ë³€ìˆ˜ ì ‘ê·¼ + ìˆ˜ì •

```kotlin
fun printProblemCounts(responses: Collection<String>) {
    var clientErrors = 0
    var serverErrors = 0
    responses.forEach {
        if (it.startsWith("4")) {
            clientErrors++
        } else if (it.startsWith("5")) {
            serverErrors++
        }
    }
    println("$clientErrors client errors, $serverErrors server errors")
}

fun main(args: Array<String>) {
    val responses = listOf("200 OK", "418 I'm a teapot",
                           "500 Internal Server Error")
    printProblemCounts(responses)
}
```

1. ëŒë‹¤ ì•ˆì—ì„œ ëŒë‹¤ ë°–ì˜ ë³€ìˆ˜ì— ì ‘ê·¼ ê°€ëŠ¥í•˜ë‹¤.
2. ëŒë‹¤ ì•ˆì—ì„œ ì‚¬ìš©í•˜ëŠ” ì™¸ë¶€ ë³€ìˆ˜ë¥¼ `í¬íš ë³€ìˆ˜(Captured Variable)`ë¼ê³  ë¶€ë¥¸ë‹¤.
3. **ìë°”**ì—ì„œë„ ë³€ìˆ˜ í¬íš ê°€ëŠ¥í•˜ì§€ë§Œ, `final` ë³€ìˆ˜ì´ê±°ë‚˜ `effectively final`(ì‹¤ì œë¡œ ë³€ê²½ë˜ì§€ ì•ŠëŠ” ë³€ìˆ˜) ì—¬ì•¼ í•œë‹¤. ë°˜ë©´, **ì½”í‹€ë¦°**ì—ì„œëŠ” `var` ë³€ìˆ˜ë„ í¬íš ê°€ëŠ¥, ë”°ë¼ì„œ ìˆ˜ì •ë„ ê°€ëŠ¥í•˜ë‹¤

<br>

## ë©¤ë²„ ì°¸ì¡°

ë©”ì„œë“œ ë˜ëŠ” í”„ë¡œí¼í‹°ë¥¼ **ëŒë‹¤ í‘œí˜„ì‹ ì—†ì´ ì§ì ‘ ì°¸ì¡°**í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ê¸°ëŠ¥

ëŒë‹¤ë¥¼ ì‚¬ìš©í•´ ë„˜ê¸°ë ¤ëŠ” ì½”ë“œê°€ ì´ë¯¸ í•¨ìˆ˜ë¡œ ì„ ì–¸ëœ ê²½ìš°, ë©¤ë²„ ì°¸ì¡° êµ¬ë¬¸`::`ì„ ì‚¬ìš©í•´ í™•ì¥ í•¨ìˆ˜ì— ëŒ€í•œ ì°¸ì¡°ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.

ë©¤ë²„ ì°¸ì¡°ëŠ” í”„ë¡œí¼í‹°ë‚˜ ë©”ì„œë“œë¥¼ ë‹¨ í•˜ë‚˜ë§Œ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜ ê°’ì„ ë§Œë“¤ì–´ì¤€ë‹¤.

ë©¤ë²„ ì°¸ì¡°ëŠ” ê·¸ ë©¤ë²„ë¥¼ í˜¸ì¶œí•˜ëŠ” ëŒë‹¤ì™€ ê°™ì€ íƒ€ì…ì´ë‹¤.

```kotlin
people.maxBy(Person::age) // ì†Œê´„í˜¸ì„
people.maxBy{ p -> p.age }
people.maxBy{ it.age }
```

ìµœìƒìœ„ì— ì„ ì–¸ëœ í•¨ìˆ˜ë‚˜ í”„ë¡œí¼í‹° ì°¸ì¡° ê°€ëŠ¥

```kotlin
fun salute() = println("Salute!")

fun main(args: Array<String>) {
    run(::salute)
}
```

**ìƒì„±ì ì°¸ì¡°(constructor reference)**ë¥¼ ì‚¬ìš©í•˜ë©´ í´ë˜ìŠ¤ ìƒì„± ì‘ì—…ì„ ì—°ê¸°í•˜ê±°ë‚˜ ì €ì¥í•´ë‘˜ ìˆ˜ ìˆë‹¤.Â  `::`Â ë’¤ì— í´ë˜ìŠ¤ ì´ë¦„ì„ ë„£ìœ¼ë©´ ìƒì„±ì ì°¸ì¡°ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

```kotlin
data class Person(val name: String, val age: Int)

fun main(args: Array<String>) {
    val createPerson = ::Person
    val p = createPerson("Alice", 29)
    println(p)  // Person(name=Alice, age=29)
}
```

í™•ì¥ í•¨ìˆ˜ë„ ë©¤ë²„ ì°¸ì¡° ê°€ëŠ¥í•˜ë‹¤.

```kotlin
fun Person.isAdult() = age >= 21
var predicate = Person::isAdult
```

**ë°”ìš´ë“œ ë©¤ë²„ ì°¸ì¡°**

- ì´ë¯¸ ìƒì„±ëœ ê°ì²´ì— ëŒ€í•´ì„œë„ ë©¤ë²„ ì°¸ì¡°ê°€ ê°€ëŠ¥í•˜ë‹¤!

```kotlin
data class Person(val name: String, val age: Int)
val p = Person("name", 34)
val personAgeFunction = Person::age
val dmitrysAgeFunction = p::age

fun main() {
    println(personAgeFunction(p))
    println(dmitrysAgeFunction())  // ìƒì„±ëœ ê°ì²´ì— ëŒ€í•´ì„œ ë©¤ë²„ ì°¸ì¡° í•˜ë¯€ë¡œ ì¸ì ì „ë‹¬ ë¶ˆí•„ìš”
}
```
